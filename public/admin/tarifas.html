<!DOCTYPE html>
<html lang="es">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>ParkSystem - Tarifas</title>
    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.2/dist/css/bootstrap.min.css" rel="stylesheet">
    <link href="https://fonts.googleapis.com/css2?family=Poppins:wght@300;400;500;600&display=swap" rel="stylesheet">
    <link href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.0.0/css/all.min.css" rel="stylesheet">
    <link href="../css/dashboard.css" rel="stylesheet">
    <script>
        if (!localStorage.getItem('token')) { window.location.href = '/'; }
    </script>
</head>
<body>
    <div class="sidebar">
        <div class="sidebar-header">
            <div class="logo-container"><div class="logo-circle"><span class="logo-text">PS</span></div></div>
            <h5 class="mt-3 text-white">ParkSystem</h5>
        </div>
        <nav class="sidebar-nav">
            <ul class="nav flex-column">
                <li class="nav-item"><a href="dashboard.html" class="nav-link"><i class="fas fa-tachometer-alt"></i><span>Dashboard</span></a></li>
                <li class="nav-item"><a href="vehiculos.html" class="nav-link"><i class="fas fa-car"></i><span>Vehículos</span></a></li>
                <li class="nav-item"><a href="ingreso-salida.html" class="nav-link"><i class="fas fa-right-left"></i><span>Ingreso / Salida</span></a></li>
                <li class="nav-item admin-only"><a href="tarifas.html" class="nav-link active"><i class="fas fa-money-bill-wave"></i><span>Tarifas</span></a></li>
                <li class="nav-item admin-only"><a href="usuarios.html" class="nav-link"><i class="fas fa-users"></i><span>Usuarios</span></a></li>
                <li class="nav-item admin-only"><a href="reportes.html" class="nav-link"><i class="fas fa-chart-bar"></i><span>Reportes</span></a></li>
            </ul>
        </nav>
        <div class="sidebar-footer"><a href="#" class="nav-link" id="btnLogout"><i class="fas fa-sign-out-alt"></i><span>Cerrar Sesión</span></a></div>
    </div>

    <div class="main-content">
        <nav class="navbar navbar-expand-lg navbar-light bg-white shadow-sm">
            <div class="container-fluid">
                <button class="btn btn-link sidebar-toggle"><i class="fas fa-bars"></i></button>
                <div class="navbar-collapse"><ul class="navbar-nav ms-auto"><li class="nav-item"><span class="nav-link"><i class="fas fa-user-circle me-2"></i><span id="userName">Usuario</span></span></li></ul></div>
            </div>
        </nav>

        <div class="container py-4">
            <div class="row g-4">
                <!-- Form por tipo de vehículo -->
                <div class="col-12 col-xl-8">
                    <div class="card">
                        <div class="card-header bg-white">
                            <h5 class="mb-0">Configurar Tarifas</h5>
                            <!-- Botón de ayuda (abre modal). Relacionado con este mismo archivo y con Bootstrap (no requiere JS adicional) -->
                            <button type="button" class="btn btn-outline-secondary btn-sm float-end" data-bs-toggle="modal" data-bs-target="#ayudaTarifasModal">
                                <i class="fas fa-circle-question me-1"></i>Ayuda
                            </button>
                        </div>
                        <div class="card-body">
                            <form id="tarifaForm" class="row g-3">
                                <div class="col-md-4">
                                    <label class="form-label">Tipo de vehículo</label>
                                    <select id="tipo_vehiculo" class="form-select" required>
                                        <option value="carro">Carro</option>
                                        <option value="moto">Moto</option>
                                        <option value="bici">Bicicleta</option>
                                    </select>
                                </div>
                                <div class="col-md-4">
                                    <label class="form-label">Modo de cobro</label>
                                    <select id="modo_cobro" class="form-select">
                                        <option value="mixto">Mixto</option>
                                        <option value="minuto">Por minuto</option>
                                        <option value="hora">Por hora</option>
                                        <option value="dia">Por día</option>
                                    </select>
                                </div>
                                <div class="col-12"><hr></div>
                                <div class="col-md-4">
                                    <label class="form-label">Valor minuto</label>
                                    <input type="number" min="0" step="0.01" id="valor_minuto" class="form-control" required>
                                </div>
                                <div class="col-md-4">
                                    <label class="form-label">Valor hora</label>
                                    <input type="number" min="0" step="0.01" id="valor_hora" class="form-control" required>
                                </div>
                                <div class="col-md-4">
                                    <label class="form-label">Valor día</label>
                                    <input type="number" min="0" step="0.01" id="valor_dia_completo" class="form-control" required>
                                </div>
                                <div class="col-12"><hr></div>
                                <div class="col-md-6">
                                    <label class="form-label">Hasta (min) cobrar por minuto</label>
                                    <input type="number" min="0" step="1" id="paso_minutos_a_horas" class="form-control" value="0">
                                </div>
                                <div class="col-md-6">
                                    <label class="form-label">Luego (horas) cobrar por hora antes de día</label>
                                    <input type="number" min="0" step="1" id="paso_horas_a_dias" class="form-control" value="0">
                                </div>
                                <div class="col-md-6">
                                    <label class="form-label">Redondeo de horas</label>
                                    <select id="redondeo_horas" class="form-select">
                                        <option value="arriba">Arriba (ceil)</option>
                                        <option value="exacto">Exacto</option>
                                    </select>
                                </div>
                                <div class="col-md-6">
                                    <label class="form-label">Redondeo de días</label>
                                    <select id="redondeo_dias" class="form-select">
                                        <option value="arriba">Arriba (ceil)</option>
                                        <option value="exacto">Exacto</option>
                                    </select>
                                </div>
                                <div class="col-12 d-flex justify-content-end">
                                    <button type="submit" class="btn btn-primary"><i class="fas fa-save me-2"></i>Guardar</button>
                                </div>
                            </form>
                        </div>
                    </div>
                </div>
                <div class="col-12 col-xl-4">
                    <div class="card">
                        <div class="card-header bg-white"><h5 class="mb-0">Tarifas activas</h5></div>
                        <div class="card-body">
                            <ul class="list-group" id="listaTarifas"></ul>
                        </div>
                    </div>
                </div>
            </div>
        </div>
    </div>

    <div class="position-fixed top-0 end-0 p-3" style="z-index:1100">
        <div id="toastContainer"></div>
    </div>

    <!-- Modal de Ayuda de Tarifas -->
    <!-- Explica configuraciones de modo mixto y redondeos. Solo HTML+Bootstrap; no altera lógica existente. -->
    <div class="modal fade" id="ayudaTarifasModal" tabindex="-1" aria-labelledby="ayudaTarifasLabel" aria-hidden="true">
        <div class="modal-dialog modal-lg modal-dialog-scrollable">
            <div class="modal-content">
                <div class="modal-header">
                    <h5 class="modal-title" id="ayudaTarifasLabel"><i class="fas fa-circle-question me-2"></i>Ayuda para configurar Tarifas</h5>
                    <button type="button" class="btn-close" data-bs-dismiss="modal" aria-label="Close"></button>
                </div>
                <div class="modal-body">
                    <!-- Sección: Modos de cobro -->
                    <h6 class="mb-2">Modos de cobro</h6>
                    <ul class="mb-3">
                        <li><strong>Por minuto</strong>: se cobra <em>valor minuto</em> por cada minuto estacionado.</li>
                        <li><strong>Por hora</strong>: se cobra <em>valor hora</em> por el total de horas (ver redondeo).</li>
                        <li><strong>Por día</strong>: se cobra <em>valor día</em> por cada día completo (ver redondeo).</li>
                        <li><strong>Mixto</strong>: combina por minuto, por hora y por día según umbrales definidos abajo.</li>
                    </ul>

                    <!-- Sección: Mixto -->
                    <h6 class="mb-2">Modo Mixto</h6>
                    <p class="mb-1">El modo <strong>mixto</strong> utiliza los siguientes pasos:</p>
                    <ol class="mb-3">
                        <li><strong>Hasta (min) cobrar por minuto</strong> (<code>paso_minutos_a_horas</code>): si el tiempo total es menor o igual a este valor, todo se cobra por minuto.</li>
                        <li><strong>Luego (horas) cobrar por hora antes de día</strong> (<code>paso_horas_a_dias</code>): si supera los minutos anteriores, hasta este número de horas se cobra por hora (aplica <em>redondeo de horas</em>).</li>
                        <li>Si el tiempo excede esas horas, el resto pasa a cobrarse por día (aplica <em>redondeo de días</em>).</li>
                    </ol>
                    <div class="alert alert-info py-2">
                        <div class="mb-1"><strong>Ejemplo Mixto</strong></div>
                        <div>
                            Suponga: minuto=$100, hora=$2.000, día=$15.000, <em>hasta (min)</em>=30, <em>luego (horas)</em>=5, redondeo horas=Arriba, redondeo días=Arriba.
                            <br>Si el vehículo estuvo <strong>1h 10m</strong>:
                            <br>- Supera 30 min ⇒ no es solo por minuto.
                            <br>- Está dentro de 5 horas ⇒ se cobra por hora con redondeo: 1h10m ⇒ <strong>2 horas</strong> ⇒ $4.000.
                        </div>
                    </div>

                    <!-- Sección: Redondeo -->
                    <h6 class="mb-2">Redondeo</h6>
                    <ul class="mb-3">
                        <li><strong>Redondeo de horas</strong>:
                            <ul>
                                <li><em>Arriba (ceil)</em>: cualquier fracción de hora sube a la siguiente hora. Ej.: 1h 01m ⇒ 2h.</li>
                                <li><em>Exacto</em>: se cobra solo horas completas; los minutos fuera de hora pueden entrar como minuto (en mixto) o no cobrar si solo-hora.</li>
                            </ul>
                        </li>
                        <li><strong>Redondeo de días</strong>:
                            <ul>
                                <li><em>Arriba (ceil)</em>: cualquier fracción de día sube al siguiente día.</li>
                                <li><em>Exacto</em>: se cobra día completo solo cuando se completa el día; el resto puede ir por horas/minutos en mixto.</li>
                            </ul>
                        </li>
                    </ul>

                    <div class="alert alert-secondary py-2">
                        <div class="mb-1"><strong>Consejos</strong></div>
                        <ul class="mb-0">
                            <li>Use <em>mixto</em> para escenarios realistas: minutos para estancias cortas, horas para medias, días para largas.</li>
                            <li>Si desea evitar cobros muy bajos, use redondeo <em>Arriba</em> en horas y/o días.</li>
                            <li>Ajuste los <em>pasos</em> según la operación (ej.: 30 min a horas, 5 horas a días).</li>
                        </ul>
                    </div>
                </div>
                <div class="modal-footer">
                    <button type="button" class="btn btn-secondary" data-bs-dismiss="modal">Cerrar</button>
                </div>
            </div>
        </div>
    </div>

    <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.2/dist/js/bootstrap.bundle.min.js"></script>
    <!-- Footer global (reutilizable). Relacionado con public/js/footer.js -->
    <script src="../js/footer.js"></script>
    <script src="../js/tarifas.js"></script>
</body>
</html>

